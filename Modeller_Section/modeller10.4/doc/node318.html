<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<!--Converted with LaTeX2HTML 2018.2 (Released May 16, 2018) -->
<HTML>
<HEAD>
<TITLE>Alignment.salign() &mdash; align two or more sequences/structures of proteins</TITLE>
<META NAME="description" CONTENT="Alignment.salign() &mdash; align two or more sequences/structures of proteins">
<META NAME="keywords" CONTENT="manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=utf-8">
<META NAME="Generator" CONTENT="LaTeX2HTML v2018.2">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="manual.css">
<LINK REL="STYLESHEET" HREF="pygments.css">

<LINK REL="next" HREF="node319.html">
<LINK REL="previous" HREF="node317.html">
<LINK REL="up" HREF="node292.html">
<LINK REL="next" HREF="node319.html">
</HEAD>

<BODY >

<DIV CLASS="navigation"><!--Navigation Panel-->
<A NAME="tex2html6569"
  HREF="node319.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html6563"
  HREF="node292.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html6557"
  HREF="node317.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html6565"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html6567"
  HREF="node517.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html6570"
  HREF="node319.html">Alignment.get_suboptimals()   parse</A>
<B> Up:</B> <A NAME="tex2html6564"
  HREF="node292.html">The Alignment class: comparison</A>
<B> Previous:</B> <A NAME="tex2html6558"
  HREF="node317.html">Alignment.malign3d()   align</A>
 &nbsp; <B>  <A NAME="tex2html6566"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html6568"
  HREF="node517.html">Index</A></B> 
<BR>
<BR></DIV>
<!--End of Navigation Panel-->
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL CLASS="ChildLinks">
<LI><A NAME="tex2html6571"
  HREF="node318.html#SECTION00111626100000000000000">Features of proteins used for alignment</A>
<LI><A NAME="tex2html6572"
  HREF="node318.html#SECTION00111626200000000000000">Alignment of protein sequences</A>
<LI><A NAME="tex2html6573"
  HREF="node318.html#SECTION00111626300000000000000">Alignment of protein structures with sequences</A>
<LI><A NAME="tex2html6574"
  HREF="node318.html#SECTION00111626400000000000000">Alignment of protein structures</A>
<LI><A NAME="tex2html6575"
  HREF="node318.html#SECTION00111626500000000000000">Sub-optimal alignments</A>
<LI><A NAME="tex2html6576"
  HREF="node318.html#SECTION00111626600000000000000">Alignments using external restraints</A>
<LI><A NAME="tex2html6577"
  HREF="node318.html#SECTION00111626700000000000000">Gap penalties and correcting for gaps</A>
<LI><A NAME="tex2html6578"
  HREF="node318.html#SECTION00111626800000000000000">Useful SALIGN information and commands</A>
</UL>
<!--End of Table of Child-Links-->
<HR>

<H2><A NAME="SECTION00111626000000000000000">
Alignment.salign() &mdash; align two or more sequences/structures of proteins</A>
</H2> <A NAME="29851"></A><A NAME="CMD:Alignment.salign"></A><A NAME="29854"></A><TT>salign(residue_type2='REGULAR', no_ter=False, overhang=0, off_diagonal=100, matrix_offset=0.0, gap_penalties_1d=(-900.0, -50.0), gap_penalties_2d=(3.5, 3.5, 3.5, 0.2, 4.0, 6.5, 2.0, 0.0, 0.0), gap_penalties_3d=(0.0, 1.75), feature_weights=(1.0, 0.0, 0.0, 0.0, 0.0, 0.0), rms_cutoff=3.5, fit=True, surftyp=1, fit_on_first=False, gap_function=False, align_block=0, max_gap_length=999999, align_what='BLOCK', input_weights_file=None, output_weights_file=None, weigh_sequences=False, smooth_prof_weight=10, fix_offsets=(0.0, -1.0, -2.0, -3.0, -4.0), substitution=False, comparison_type='MAT', matrix_comparison='CC', alignment_type='PROGRESSIVE', edit_file_ext=('.pdb', '_fit.pdb'), weights_type='SIMILAR', similarity_flag=False, bkgrnd_prblty_file='$(LIB)/blosum62_bkgrnd.prob', ext_tree_file=None, dendrogram_file='', matrix_scaling_factor=0.0069, auto_overhang=False, overhang_factor=0.4, overhang_auto_limit=60, local_alignment=False, improve_alignment=True, fit_atoms='CA', output='', write_whole_pdb=True, current_directory=True, write_fit=False, fit_pdbnam=True, rr_file='$(LIB)/as1.sim.mat', n_subopt=0, subopt_offset=0.0, align3d_trf=False, normalize_pp_scores=False, gap_gap_score=0.0, gap_residue_score=0.0, nsegm=2, matrix_offset_3d=-0.1, break_break_bonus=10000.0, io=None)</TT>
<BR><DL>
<DT><STRONG>Output:</STRONG></DT>
<DD><I CLASS="sans">SalignData</I><A NAME="29861"></A> object
                             
</DD>
</DL>

<P>
<BLOCKQUOTE>
This command is a general dynamic programming based alignment
procedure for aligning sequences, structures or a combination of the two. It
is loosely based on the program COMPARER [<A
 HREF="node516.html#SalBlu90">&#352;ali &amp; Blundell, 1990</A>]. SALIGN can be used
to generate multiple protein structures/sequences alignments or to align two
blocks of sequences/structures that are in memory.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>See also Section&nbsp;<A HREF="node461.html#SECTION:salign">6.34</A> for utility scripts to simplify the
high-level usage of SALIGN.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>Please note that the method is still in development, and has not yet been
fully benchmarked. As with any other alignment method, generated alignments
should be assessed for quality.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>Broadly classifying, three different types of protein alignment categories
are tackled by this command:
</BLOCKQUOTE>
<OL>
<LI>Multiple structure alignments
</LI>
<LI>Aligning a structure block to a sequence block
</LI>
<LI>Multiple and pair-wise protein sequence alignment
</LI>
</OL>
<P>
<BLOCKQUOTE>The command incorporates the functionality of several old M<SMALL>ODELLER</SMALL> commands
(<B><A HREF="node311.html#CMD:Alignment.align">Alignment.align()</A></B><A NAME="30176"></A>, <B><A HREF="node312.html#CMD:Alignment.align2d">Alignment.align2d()</A></B><A NAME="30181"></A>, <B><A HREF="node313.html#CMD:Alignment.malign">Alignment.malign()</A></B><A NAME="30186"></A>,
<B><A HREF="node316.html#CMD:Alignment.align3d">Alignment.align3d()</A></B><A NAME="30191"></A>, and <B><A HREF="node317.html#CMD:Alignment.malign3d">Alignment.malign3d()</A></B><A NAME="30196"></A>). Some of the examples
below illustrate the equivalent script files to replace the old alignment
commands with <B><A HREF="#CMD:Alignment.salign">Alignment.salign()</A></B><A NAME="30201"></A>.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>In addition to these, this command has several new alignment features
including profile-profile sequence alignments and a dendrogram based multiple
sequence/structure alignment among others.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>All pair-wise alignments make use of local or global dynamic programming.
A switch from one to another can be effected by setting <I CLASS="sans">local_alignment</I><A NAME="30206"></A>
to <TT>True</TT> or <TT>False</TT>. The dynamic programming can be carried out using
affine gap penalties (as previously used in <B><A HREF="node311.html#CMD:Alignment.align">Alignment.align()</A></B><A NAME="30211"></A>, by setting
<I CLASS="sans">gap_function</I><A NAME="30216"></A> to <TT>False</TT>) or an environment dependent gap penalty
function (as used in <B><A HREF="node312.html#CMD:Alignment.align2d">Alignment.align2d()</A></B><A NAME="30220"></A>, by setting <I CLASS="sans">gap_function</I><A NAME="30225"></A> to
<TT>True</TT>). (Please note that the default <I CLASS="sans">gap_penalties_1d</I><A NAME="30229"></A> parameters
are optimal for the affine gap penalty; see the align2d examples for reasonable
parameters if you wish to use the environment dependent gap penalty.)
All arguments that associated to the <B><A HREF="node311.html#CMD:Alignment.align">Alignment.align()</A></B><A NAME="30232"></A> and
<B><A HREF="node312.html#CMD:Alignment.align2d">Alignment.align2d()</A></B><A NAME="30237"></A> commands apply.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>If at least one of the blocks in a pairwise alignment consists of structures,
dynamic programming can be performed using structure dependent gap penalties.
</BLOCKQUOTE>
<P>
<BLOCKQUOTE>On successful completion, an <I CLASS="sans">SalignData</I><A NAME="30242"></A> object is returned, from which
some of the calculated data can be queried. For example, if you save this in
a variable 'r', the following data are available:
</BLOCKQUOTE>
<UL>
<LI><TT>r.aln_score</TT>; the alignment score
</LI>
<LI><TT>r.qscorepct</TT>; the quality score (percentage) if <I CLASS="sans">output</I><A NAME="30247"></A> contains
<TT>'QUALITY'</TT>
</LI>
</UL>
<P>
<H3><A NAME="SECTION00111626100000000000000">
Features of proteins used for alignment</A>
</H3>
Central to the dynamic programming algorithm is the weight matrix. In SALIGN,
this matrix is constructed by weighting the contribution from six 
features of protein structure and sequence:

<P>
<DL>
<DT><STRONG>Feature 1</STRONG></DT>
<DD>is the residue type. <SPAN CLASS="MATH"><IMG
 WIDTH="34" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img123.png"
 ALT="$W^1_{i,j}$"></SPAN> is obtained from the residue
type - residue type dissimilarity matrix, specified in the file <I CLASS="sans">rr_file</I><A NAME="30251"></A>.
<SPAN CLASS="MATH"><IMG
 WIDTH="34" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img123.png"
 ALT="$W^1_{i,j}$"></SPAN> dissimilarity score for positions <SPAN CLASS="MATH"><IMG
 WIDTH="10" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img60.png"
 ALT="$i$"></SPAN> and <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img66.png"
 ALT="$j$"></SPAN> in the two compared
sub-alignments is the average dissimilarity score for a comparison of all
residues in one sub-alignment with all residues in the other sub-alignment
(note that gaps are ignored here). Should only feature weight 1 be non-zero,
the user has an option of considering residue-residue similarity scores
instead of distance scores by setting <I CLASS="sans">similarity_flag</I><A NAME="30254"></A> to <TT>True</TT>.
(The other features are distance features, and so if their weights are non-zero,
<I CLASS="sans">similarity_flag</I><A NAME="30258"></A> must be turned off, which is the default.)

<P>
</DD>
<DT><STRONG>Feature 2</STRONG></DT>
<DD>is the inter-molecular distance for a pair of residues (unless
<I CLASS="sans">align3d_trf</I><A NAME="30261"></A> is <TT>True</TT>: see <B><A HREF="node316.html#CMD:Alignment.align3d">Alignment.align3d()</A></B><A NAME="30265"></A>). Only one atom per
residue is of course selected, as specified by <I CLASS="sans">fit_atoms</I><A NAME="30270"></A> (<EM>e.g.</EM>, <!-- MATH
 ${C}_\alpha$
 -->
<SPAN CLASS="MATH">C<sub>&alpha;</sub></SPAN>,
although we should also allow for <SPAN CLASS="MATH"><IMG
 WIDTH="24" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img124.png"
 ALT="${C}_\beta$"></SPAN> in the future, which requires an
intervention for Gly). This &lsquo;position&rsquo; feature is complicated because it
depends on the relative orientation of the structures corresponding to the two
compared alignments. <SPAN CLASS="MATH"><IMG
 WIDTH="34" HEIGHT="34" ALIGN="MIDDLE" BORDER="0"
 SRC="img125.png"
 ALT="$W^2_{i,j}$"></SPAN> is the Euclidean distance between the
compared positions <SPAN CLASS="MATH"><IMG
 WIDTH="10" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img60.png"
 ALT="$i$"></SPAN> and <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img66.png"
 ALT="$j$"></SPAN> in the two compared sub-alignments that are
already optimally aligned and superposed based on their coordinates alone.
This optimal alignment is obtained by an iterative procedure as follows
(the same as in <B><A HREF="node316.html#CMD:Alignment.align3d">Alignment.align3d()</A></B><A NAME="30276"></A>). The average structures for both
sub-alignments are calculated for all sub-alignment positions with at least
one defined selected atom. This calculation is straightforward because the
structures within the two sub-alignments are already superposed with each
other (see below). Then, the distance matrix for dynamic programming with affine
gap penalties is calculated as the matrix of Euclidean distances between
the two averages. The dynamic programming results into a new alignment,
dependent also on the gap initiation and extension penalties
<I CLASS="sans">gap_penalties_3d</I><A NAME="30281"></A> (a reasonable setting is (0, 3)).
<I CLASS="sans">gap_penalties_3d</I><A NAME="30284"></A>[0] is a gap creation penalty (usually 0), and
<I CLASS="sans">gap_penalties_3d</I><A NAME="30287"></A>[1] is a gap extension penalty, say 3. When the gap
initiation penalty is 0, pairs of positions are identified as equivalent
when they have their selected atoms at most 2 times <I CLASS="sans">gap_penalties_3d</I><A NAME="30290"></A>[1]
angstroms apart in the current superposition, as described for the
<B><A HREF="node316.html#CMD:Alignment.align3d">Alignment.align3d()</A></B><A NAME="30293"></A> command. The new alignment is then used to generate
the new superposition of the two averages, and the iteration of the distance
matrix calculation, alignment and superposition is repeated until there are
no changes in the number of equivalent positions and in the rotation matrix
relating the two averages.

<P>
The values of both <I CLASS="sans">improve_alignment</I><A NAME="30298"></A> and <I CLASS="sans">fit</I><A NAME="30301"></A> are used in the
calculation of the position feature. That is, the initial alignment and
the orientation of the coordinates can be selected not to change at all
during the calculation of the inter-molecular distance matrix.

<P>
When the calculation of the inter-molecular distance matrix is finished, all
the structures in the second sub-alignment are rotated and translated
following the optimal rotation and translation of the second average on the
first average. These superpositions prepare the individual structures for the
next of the <SPAN CLASS="MATH"><IMG
 WIDTH="41" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img126.png"
 ALT="$n-1$"></SPAN> stages of the progressive multiple alignment, and also
orient all the structures for writing out to atom files with a <TT>'_fit.pdb'</TT>
extension if <I CLASS="sans">write_fit</I><A NAME="30305"></A> = <TT>True</TT>. If <I CLASS="sans">fit_pdbnam</I><A NAME="30309"></A> = <TT>False</TT>, the
PDB filenames in the output alignment file will not have the <TT>'_fit.pdb'</TT>
extensions. Thus, feature 2 needs to be selected by
<I CLASS="sans">feature_weight</I><A NAME="30314"></A>[2]&nbsp;<SPAN CLASS="MATH"><IMG
 WIDTH="29" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img127.png"
 ALT="$&gt; 0$"></SPAN> if you wish to write out the structures
superposed according to the tree-following procedure; also, <I CLASS="sans">fit_on_first</I><A NAME="30317"></A>
must be <TT>False</TT>, otherwise the structures are written out superposed on the
first structure according to the final alignment (see also below).

<P>
The alignment produced within the routine that calculates <SPAN CLASS="MATH"><IMG
 WIDTH="29" HEIGHT="17" ALIGN="BOTTOM" BORDER="0"
 SRC="img128.png"
 ALT="$W^2$"></SPAN> does not
generally correspond to the alignment calculated based on <SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img129.png"
 ALT="$W$"></SPAN>. Therefore, the
multiply superposed structures are not necessarily superposed based on the
final multiple alignment produced by <B><A HREF="#CMD:Alignment.salign">Alignment.salign()</A></B><A NAME="30321"></A>. If you wish such
a superposition, you can use <B><A HREF="node317.html#CMD:Alignment.malign3d">Alignment.malign3d()</A></B><A NAME="30326"></A> with <I CLASS="sans">fit</I><A NAME="30331"></A> = <TT>False</TT>
and <I CLASS="sans">write_fit</I><A NAME="30335"></A> = <TT>True</TT> (the meaning of <I CLASS="sans">fit</I><A NAME="30339"></A> is different between
<B><A HREF="#CMD:Alignment.salign">Alignment.salign()</A></B><A NAME="30342"></A> and <B><A HREF="node317.html#CMD:Alignment.malign3d">Alignment.malign3d()</A></B><A NAME="30347"></A>).

<P>
Unless the position feature is selected, the initial alignment does not matter.
If the position feature is selected, a good starting alignment is a multiple
sequence alignment, obtained either by <B><A HREF="node313.html#CMD:Alignment.malign">Alignment.malign()</A></B><A NAME="30352"></A> or by
<B><A HREF="#CMD:Alignment.salign">Alignment.salign()</A></B><A NAME="30357"></A> used without the position feature (the initial
alignment can also be prepared using the position feature). If the position
feature is used, each pair of structures needs to have at least 3 aligned
residues at all points during the alignment.

<P>
There are several possibilities as to the final orientation of the input
coordinates. If <I CLASS="sans">fit_on_first</I><A NAME="30362"></A> is <TT>True</TT>, all the coordinate sets are
superposed on the first structure, using the final multi-feature multiple
alignment. If <I CLASS="sans">fit_on_first</I><A NAME="30366"></A> is <TT>False</TT>, and position feature was used,
and <I CLASS="sans">fit</I><A NAME="30370"></A> was <TT>True</TT>, the coordinates will be superposed in the
progressive manner guided by the tree, by the routine that calculates the
inter-molecular distance matrices; this superposition is based only on the
positions of the selected atoms (feature 2), not on other features such as
residue type, secondary, structure, <EM>etc</EM>. If <I CLASS="sans">improve_alignment</I><A NAME="30375"></A> is
<TT>False</TT>, it does not make much sense to have <I CLASS="sans">fit</I><A NAME="30379"></A> = <TT>True</TT>
(use <I CLASS="sans">fit_on_first</I><A NAME="30383"></A> = <TT>True</TT>).

<P>
For local alignments, the matrix offset variable is <I CLASS="sans">matrix_offset_3d</I><A NAME="30387"></A>.

<P>
</DD>
<DT><STRONG>Feature 3</STRONG></DT>
<DD>is the fractional sidechain accessibility. The pair-wise
residue-residue dissimilarity is calculated by classifying residues into the
buried (<SPAN CLASS="MATH"><IMG
 WIDTH="37" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img130.png"
 ALT="$&lt;15$"></SPAN>%), semi-exposed, and exposed classes (<SPAN CLASS="MATH"><IMG
 WIDTH="37" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img131.png"
 ALT="$&gt;30$"></SPAN>%). The
dissimilarity is 0 for equal classes or if the absolute difference in the
accessibility is less than 5%, 1 for neighboring classes and 2 for
the buried-exposed match.  The position-position dissimilarity is the
average residue-residue dissimilarity for comparing all residues from
one group to all residues in the other group (gaps are ignored).

<P>
</DD>
<DT><STRONG>Feature 4</STRONG></DT>
<DD>is the secondary structure type, distinguishing between helix,
strand, and other. The pair-wise residue-residue dissimilarity is 0 for
equal classes, 1 for &lsquo;helix&rsquo; or &lsquo;strand&rsquo; matched to &lsquo;other&rsquo;, and 2 for
&lsquo;helix&rsquo; matched to 'strand'. Position-position dissimilarity is calculated
in the same way as for feature 3.

<P>
</DD>
<DT><STRONG>Feature 5</STRONG></DT>
<DD>is the local conformation. A pair-wise residue-residue score
is DRMSD between the selected atoms (<I CLASS="sans">fit_atoms</I><A NAME="30390"></A>) from the segments of
(2*nsegm + 1) residues centered on the two matched residues. Position-position
dissimilarity is calculated in the same way as for feature 3.

<P>
</DD>
<DT><STRONG>Feature 6</STRONG></DT>
<DD>is a user specified feature for which a external matrix (in 
M<SMALL>ODELLER</SMALL> matrix format; see the substitution matrices in the <TT>modlib</TT>
directory for examples) has to be specified using <I CLASS="sans">input_weights_file</I><A NAME="30395"></A>.
The user can input either a similarity matrix (<I CLASS="sans">weights_type</I><A NAME="30398"></A> = <TT>SIMILAR</TT>)
or a distance matrix (<I CLASS="sans">weights_type</I><A NAME="30402"></A> = <TT>DISTANCE</TT>).

<P>
</DD>
</DL>

<P>

<H3><A NAME="SECTION00111626200000000000000">
Alignment of protein sequences</A>
</H3>

<UL>
<LI><B>Multiple protein sequence alignment</B> 
<BR>
Aligning multiple sequences is similar to aligning multiple structures, 
the difference being that for sequence alignments only the first feature weight
can be non-zero (the other features require coordinates). This is the default
for <I CLASS="sans">feature_weights</I><A NAME="30406"></A>.

<P>

  <DL>
<DT><STRONG>Example: <A NAME="tex2html191"
  HREF="../examples/salign/salign_multiple_seq.py">examples/salign/salign_multiple_seq.py</A></STRONG></DT>
<DD> <BR>  <div class="pygments"><pre><span></span><span class="c1"># Illustrates the SALIGN multiple sequence alignment</span>
<span class="kn">from</span> <span class="nn">modeller</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">()</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environ</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">atom_files_directory</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;../atom_files&#39;</span><span class="p">]</span>

<span class="n">aln</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="s1">&#39;malign_in.ali&#39;</span><span class="p">)</span>

<span class="n">aln</span><span class="o">.</span><span class="n">salign</span><span class="p">(</span><span class="n">overhang</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">gap_penalties_1d</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">450</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">),</span>
           <span class="n">alignment_type</span><span class="o">=</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;ALIGNMENT&#39;</span><span class="p">)</span>

<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;malign.ali&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PIR&#39;</span><span class="p">)</span>
</pre></div>
  
</DD>
</DL>  <BR>
<P>
</LI>
<LI><B>Alignment of two sequence blocks</B> 
<BR>
Two blocks of sequences can be aligned using the information contained within
each of the multiple sequence blocks [<A
 HREF="node516.html#MarSal04">Mart&#305;-Renom <EM>et&nbsp;al.</EM>, 2004</A>].
Pairs of sequence blocks are aligned using SALIGN the same way in which 
<B><A HREF="node311.html#CMD:Alignment.align">Alignment.align()</A></B><A NAME="30413"></A> aligned sequence blocks; to align two blocks, simply
proceed as normal, but set <I CLASS="sans">align_block</I><A NAME="30418"></A> to the number of sequences in
the first block (the rest of the sequences are placed in the second block) and
set <I CLASS="sans">alignment_what</I><A NAME="30421"></A> to <TT>BLOCK</TT>. Also, since this kind of alignment is
effected only between two blocks, <I CLASS="sans">alignment_type</I><A NAME="30425"></A> is set to <TT>PAIRWISE</TT>.

<P>
</LI>
<LI><B>Alignment of protein sequences by their profiles</B> 
<BR>
As for pairwise alignment of sequence blocks, above, two blocks can be
aligned by their profiles. <I CLASS="sans">align_block</I><A NAME="30429"></A>
demarcates the end of the first block and <I CLASS="sans">align_what</I><A NAME="30432"></A> is set to <TT>PROFILE</TT>
indicating that the blocks will be aligned using their profiles, and
<I CLASS="sans">alignment_type</I><A NAME="30436"></A> is set to <TT>PAIRWISE</TT>.
The weight matrix for dynamic programming is created by comparing the sequence
information in the two blocks. Two kinds of comparisons can be performed:
  
<OL>
<LI>A correlation coefficient of the variation of the 20 amino acids at
  each position (<I CLASS="sans">comparison_type</I><A NAME="30440"></A> is set to <TT>PSSM</TT>).
</LI>
<LI>Comparing the residue substitution matrices implied at each position of
  the two blocks (<I CLASS="sans">comparison_type</I><A NAME="30444"></A> is set to <TT>MAT</TT>).
  
</LI>
</OL>
Matrix comparisons are of three types:
taking the maximum, average or correlation coefficient of residue-residue 
substitution at the aligned positions (<I CLASS="sans">matrix_comparison</I><A NAME="30448"></A> set to <TT>MAX</TT>, 
<TT>AVE</TT> or <TT>CC</TT>).

<P>
Profile comparisons are done in similarity space rather than distance space,
so <I CLASS="sans">similarity_flag</I><A NAME="30454"></A> should be set to <TT>True</TT>. They will also currently
only work with feature 1 (since feature 1 is the only feature which works both
in similarity and in distance space) - the weights for all other features
must be set to zero.

<P>

  <DL>
<DT><STRONG>Example: <A NAME="tex2html192"
  HREF="../examples/salign/salign_profile_profile.py">examples/salign/salign_profile_profile.py</A></STRONG></DT>
<DD> <BR>  <div class="pygments"><pre><span></span><span class="c1"># profile-profile alignment using salign</span>
<span class="kn">from</span> <span class="nn">modeller</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">log</span><span class="o">.</span><span class="n">level</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environ</span><span class="p">()</span>

<span class="n">aln</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="s1">&#39;mega_prune.faa&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;FASTA&#39;</span><span class="p">)</span>

<span class="n">aln</span><span class="o">.</span><span class="n">salign</span><span class="p">(</span><span class="n">rr_file</span><span class="o">=</span><span class="s1">&#39;${LIB}/blosum62.sim.mat&#39;</span><span class="p">,</span>
           <span class="n">gap_penalties_1d</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
           <span class="n">align_block</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>   <span class="c1"># no. of seqs. in first MSA</span>
           <span class="n">align_what</span><span class="o">=</span><span class="s1">&#39;PROFILE&#39;</span><span class="p">,</span>
           <span class="n">alignment_type</span><span class="o">=</span><span class="s1">&#39;PAIRWISE&#39;</span><span class="p">,</span>
           <span class="n">comparison_type</span><span class="o">=</span><span class="s1">&#39;PSSM&#39;</span><span class="p">,</span>  <span class="c1"># or &#39;MAT&#39; (Caution: Method NOT benchmarked</span>
                                    <span class="c1"># for &#39;MAT&#39;)</span>
           <span class="n">similarity_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>    <span class="c1"># The score matrix is not rescaled</span>
           <span class="n">substitution</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>       <span class="c1"># The BLOSUM62 substitution values are</span>
                                    <span class="c1"># multiplied to the corr. coef.</span>
           <span class="c1">#output_weights_file=&#39;test.mtx&#39;, # optional, to write weight matrix</span>
           <span class="n">smooth_prof_weight</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span> <span class="c1"># For mixing data with priors</span>

<span class="c1">#write out aligned profiles (MSA)</span>
<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;salign.ali&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PIR&#39;</span><span class="p">)</span>

<span class="c1"># Make a pairwise alignment of two sequences</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="s1">&#39;salign.ali&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PIR&#39;</span><span class="p">,</span>
                <span class="n">align_codes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;12asA&#39;</span><span class="p">,</span> <span class="s1">&#39;1b8aA&#39;</span><span class="p">))</span>
<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;salign_pair.ali&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PIR&#39;</span><span class="p">)</span>
<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;salign_pair.pap&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PAP&#39;</span><span class="p">)</span>
</pre></div>
  
</DD>
</DL>  <BR>
<P>
</LI>
</UL>

<P>

<H3><A NAME="SECTION00111626300000000000000">
Alignment of protein structures with sequences</A>
</H3>
As stated earlier, all <B><A HREF="node311.html#CMD:Alignment.align">Alignment.align()</A></B><A NAME="30462"></A> and <B><A HREF="node312.html#CMD:Alignment.align2d">Alignment.align2d()</A></B><A NAME="30467"></A> related
commands apply to <B><A HREF="#CMD:Alignment.salign">Alignment.salign()</A></B><A NAME="30472"></A> too. The example below is a 
<B><A HREF="#CMD:Alignment.salign">Alignment.salign()</A></B><A NAME="30477"></A> equivalent of <B><A HREF="node312.html#CMD:Alignment.align2d">Alignment.align2d()</A></B><A NAME="30482"></A> (and 
<B><A HREF="node311.html#CMD:Alignment.align">Alignment.align()</A></B><A NAME="30487"></A>). For a description of the <I CLASS="sans">gap_penalties_2d</I><A NAME="30492"></A> see the 
section on <B><A HREF="node312.html#CMD:Alignment.align2d">Alignment.align2d()</A></B><A NAME="30495"></A>.

<P>

  <DL>
<DT><STRONG>Example: <A NAME="tex2html193"
  HREF="../examples/salign/salign_align2d.py">examples/salign/salign_align2d.py</A></STRONG></DT>
<DD> <BR>  <div class="pygments"><pre><span></span><span class="c1"># align2d/align using salign</span>

<span class="c1"># parameters to be input by the user</span>
<span class="c1"># 1.  gap_penalties_1d</span>
<span class="c1"># 2.  gap_penalties_2d</span>
<span class="c1"># 3.  input alignment file</span>

<span class="kn">from</span> <span class="nn">modeller</span> <span class="kn">import</span> <span class="o">*</span>
<span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">()</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environ</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">atom_files_directory</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;../atom_files&#39;</span><span class="p">]</span>

<span class="n">aln</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="s1">&#39;align2d_in.ali&#39;</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">aln</span><span class="o">.</span><span class="n">salign</span><span class="p">(</span><span class="n">rr_file</span><span class="o">=</span><span class="s1">&#39;$(LIB)/as1.sim.mat&#39;</span><span class="p">,</span>  <span class="c1"># Substitution matrix used</span>
           <span class="n">output</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
           <span class="n">max_gap_length</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
           <span class="n">gap_function</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>              <span class="c1"># If False then align2d not done</span>
           <span class="n">feature_weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span>
           <span class="n">gap_penalties_1d</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
           <span class="n">gap_penalties_2d</span><span class="o">=</span><span class="p">(</span><span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">4.0</span><span class="p">,</span> <span class="mf">6.5</span><span class="p">,</span> <span class="mf">2.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">),</span>
           <span class="c1"># d.p. score matrix</span>
           <span class="c1">#output_weights_file=&#39;salign.mtx&#39;</span>
           <span class="n">similarity_flag</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>   <span class="c1"># Ensuring that the dynamic programming</span>
                                   <span class="c1"># matrix is not scaled to a difference matrix</span>
<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;align2d.ali&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PIR&#39;</span><span class="p">)</span>
<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;align2d.pap&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PAP&#39;</span><span class="p">)</span>
</pre></div>
  
</DD>
</DL>  <BR>
<P>
Caution: The values of <I CLASS="sans">gap_penalties_2d</I><A NAME="30504"></A> have been optimized for
similarity matrices. If using a distance matrix, you will need to derive new
optimized values.

<P>

<H3><A NAME="SECTION00111626400000000000000">
Alignment of protein structures</A>
</H3>
Structure alignments can make use of all the 5 structure/sequence features
as well as the 6th user provided feature matrix. Pairwise alignments of
structures can make use of the constant gap penalties or the environment 
dependent gap penalties. Multiple structure alignments are constructed from
pairwise structure alignments.

<P>
This section describes the use of SALIGN to produce a single alignment of
multiple structures. If the best output alignment is desired, it is recommended
to run SALIGN in an iterative fashion, to determine the best parameter values.
A utility script is provided for this purpose - see
<B><A HREF="node462.html#CMD:iterativestructuralalign">iterative_structural_align()</A></B><A NAME="30507"></A>.

<P>

<UL>
<LI><B>Pairwise protein structure alignment</B> 
<BR>
For optimal pairwise alignments it is suggested to call SALIGN multiple times,
typically 2-3 times. The first SALIGN call will give an initial alignment which
is refined in the subsequent calls. Usually, feature 2 is made non-zero only
during the 'refinement' stage as rigid body refinement is done at the position
implied by the alignment in memory. 

<P>
</LI>
<LI><B>Tree Multiple Structure Alignments</B> 
<BR>
When <I CLASS="sans">alignment_type</I><A NAME="30512"></A> is set to <TT>tree</TT>, a dendrogram of the <SPAN CLASS="MATH"><IMG
 WIDTH="14" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img43.png"
 ALT="$n$"></SPAN> proteins 
in memory is calculated using the selected features. The multiple alignment is 
then a progression of <SPAN CLASS="MATH"><IMG
 WIDTH="41" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img126.png"
 ALT="$n-1$"></SPAN> pairwise alignments of the growing sub-alignments.
A sub-alignment is an alignment of <SPAN CLASS="MATH"><IMG
 WIDTH="31" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img132.png"
 ALT="$&lt;n$"></SPAN> proteins. The pairwise alignment of two 
sub-alignments is achieved using affine or environment dependent gap penalties,
depending on whether <I CLASS="sans">gap_function</I><A NAME="30516"></A> is set to <TT>False</TT> or <TT>True</TT> 
(arguments to the <B><A HREF="node311.html#CMD:Alignment.align">Alignment.align()</A></B><A NAME="30521"></A> and <B><A HREF="node312.html#CMD:Alignment.align2d">Alignment.align2d()</A></B><A NAME="30526"></A> commands 
apply).

<P>
</LI>
<LI><B>Progressive Multiple Structure Alignments</B> 
<BR>
If <I CLASS="sans">alignment_type</I><A NAME="30531"></A> is set to <TT>progressive</TT>, the multiple alignment
follows only the last part of the &lsquo;tree&rsquo; alignment where, in <SPAN CLASS="MATH"><IMG
 WIDTH="41" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img126.png"
 ALT="$n-1$"></SPAN> alignments,
all the structures/sequences are successively aligned to the first one on the
list.
</LI>
</UL>

<P>
The alignment of proteins within a sub-alignment does not change when the
sub-alignment is aligned with another protein or sub-alignment. The pairwise
alignment of sub-alignments is guided by the dendrogram. First, the most
similar pair of proteins are aligned. Second, the next most similar pair of
proteins are aligned, or the third protein is aligned with the sub-alignment
of the first two, as indicated by the dendrogram. This greedy, progressive
procedure requires <SPAN CLASS="MATH"><IMG
 WIDTH="41" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img126.png"
 ALT="$n-1$"></SPAN> steps to align all <SPAN CLASS="MATH"><IMG
 WIDTH="14" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img43.png"
 ALT="$n$"></SPAN> proteins, and each step
requires a pairwise alignment of two sub-alignments.

<P>
If in a multiple alignment, overhangs are to be penalized differently for
the pairs of alignments that create the multiple, <I CLASS="sans">auto_overhang</I><A NAME="30535"></A> can be 
set to <TT>True</TT>. This will ensure that the value of <I CLASS="sans">overhang</I><A NAME="30539"></A> changes as
<I CLASS="sans">overhang_factor</I><A NAME="30542"></A> times the numerical difference in the residues of the 
pair. Further, this is only effected if the difference is greater than 
<I CLASS="sans">overhang_auto_limit</I><A NAME="30545"></A>.

<P>
The dendrogram can be written out in a separate file by specifying the 
file name to <I CLASS="sans">dendrogram_file</I><A NAME="30548"></A>.

<P>

  <DL>
<DT><STRONG>Example: <A NAME="tex2html194"
  HREF="../examples/salign/salign_multiple_struc.py">examples/salign/salign_multiple_struc.py</A></STRONG></DT>
<DD> <BR>  <div class="pygments"><pre><span></span><span class="c1"># Illustrates the SALIGN multiple structure/sequence alignment</span>
<span class="kn">from</span> <span class="nn">modeller</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">()</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environ</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">atom_files_directory</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;../atom_files&#39;</span><span class="p">]</span>

<span class="n">aln</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">env</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">chain</span><span class="p">)</span> <span class="ow">in</span> <span class="p">((</span><span class="s1">&#39;1is4&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;1uld&#39;</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;1ulf&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span>
                      <span class="p">(</span><span class="s1">&#39;1ulg&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;1is5&#39;</span><span class="p">,</span> <span class="s1">&#39;A&#39;</span><span class="p">)):</span>
    <span class="n">mdl</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">model_segment</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;FIRST:&#39;</span><span class="o">+</span><span class="n">chain</span><span class="p">,</span> <span class="s1">&#39;LAST:&#39;</span><span class="o">+</span><span class="n">chain</span><span class="p">))</span>
    <span class="n">aln</span><span class="o">.</span><span class="n">append_model</span><span class="p">(</span><span class="n">mdl</span><span class="p">,</span> <span class="n">atom_files</span><span class="o">=</span><span class="n">code</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="n">code</span><span class="o">+</span><span class="n">chain</span><span class="p">)</span>

<span class="k">for</span> <span class="p">(</span><span class="n">weights</span><span class="p">,</span> <span class="n">write_fit</span><span class="p">,</span> <span class="n">whole</span><span class="p">)</span> <span class="ow">in</span> <span class="p">(((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                                    <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span><span class="p">),</span>
                                    <span class="p">((</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">),</span> <span class="bp">True</span><span class="p">,</span> <span class="bp">False</span><span class="p">)):</span>
    <span class="n">aln</span><span class="o">.</span><span class="n">salign</span><span class="p">(</span><span class="n">rms_cutoff</span><span class="o">=</span><span class="mf">3.5</span><span class="p">,</span> <span class="n">normalize_pp_scores</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
               <span class="n">rr_file</span><span class="o">=</span><span class="s1">&#39;$(LIB)/as1.sim.mat&#39;</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
               <span class="n">gap_penalties_1d</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">450</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">),</span>
               <span class="n">gap_penalties_3d</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">gap_gap_score</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gap_residue_score</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
               <span class="n">dendrogram_file</span><span class="o">=</span><span class="s1">&#39;1is3A.tree&#39;</span><span class="p">,</span>
               <span class="n">alignment_type</span><span class="o">=</span><span class="s1">&#39;tree&#39;</span><span class="p">,</span> <span class="c1"># If &#39;progresive&#39;, the tree is not</span>
                                      <span class="c1"># computed and all structues will be</span>
                                      <span class="c1"># aligned sequentially to the first</span>
               <span class="c1">#ext_tree_file=&#39;1is3A_exmat.mtx&#39;, # Tree building can be avoided</span>
                                                 <span class="c1"># if the tree is input</span>
               <span class="n">feature_weights</span><span class="o">=</span><span class="n">weights</span><span class="p">,</span> <span class="c1"># For a multiple sequence alignment only</span>
                                        <span class="c1"># the first feature needs to be non-zero</span>
               <span class="n">improve_alignment</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">write_fit</span><span class="o">=</span><span class="n">write_fit</span><span class="p">,</span>
               <span class="n">write_whole_pdb</span><span class="o">=</span><span class="n">whole</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;ALIGNMENT QUALITY&#39;</span><span class="p">)</span>

<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;1is3A.pap&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PAP&#39;</span><span class="p">)</span>
<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;1is3A.ali&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PIR&#39;</span><span class="p">)</span>

<span class="c1"># The number of equivalent positions at different RMS_CUTOFF values can be</span>
<span class="c1"># computed by changing the RMS value and keeping all feature weights = 0</span>
<span class="n">aln</span><span class="o">.</span><span class="n">salign</span><span class="p">(</span><span class="n">rms_cutoff</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
           <span class="n">normalize_pp_scores</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">rr_file</span><span class="o">=</span><span class="s1">&#39;$(LIB)/as1.sim.mat&#39;</span><span class="p">,</span> <span class="n">overhang</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
           <span class="n">gap_penalties_1d</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">450</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">),</span> <span class="n">gap_penalties_3d</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span>
           <span class="n">gap_gap_score</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">gap_residue_score</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">dendrogram_file</span><span class="o">=</span><span class="s1">&#39;1is3A.tree&#39;</span><span class="p">,</span>
           <span class="n">alignment_type</span><span class="o">=</span><span class="s1">&#39;progressive&#39;</span><span class="p">,</span> <span class="n">feature_weights</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="mi">6</span><span class="p">,</span>
           <span class="n">improve_alignment</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">fit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">write_fit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
           <span class="n">write_whole_pdb</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;QUALITY&#39;</span><span class="p">)</span>
</pre></div>
  
</DD>
</DL>  <BR>
<P>

<H3><A NAME="SECTION00111626500000000000000">
Sub-optimal alignments</A>
</H3>
The weight matrix can be offset at random, many times
over, to generate several &lsquo;sub-optimal&rsquo; alignments. The number of sub-optimal
alignments to be output can be specified with <I CLASS="sans">n_subopt</I><A NAME="30555"></A>. Though the matrix
positions at which these offsets are applied cannot be controlled, the user
can choose by how much the matrix will be offset (<I CLASS="sans">subopt_offset</I><A NAME="30558"></A>). The
alignments are written into the file 'suboptimal_alignments.out'
(or 'suboptimal_alignments2d.out' if <I CLASS="sans">gap_function</I><A NAME="30561"></A> is <TT>True</TT>)
in a simple format. For each such alignment, an <TT>'ALIGNMENT:'</TT> line is written,
containing in order

<UL>
<LI>the number of the alignment (the first alignment is numbered 0, and is
the true or 'optimal' alignment, for reference)
</LI>
<LI>the start, end and length of the alignment
</LI>
<LI>the number of aligned positions
</LI>
<LI>the score of the alignment
</LI>
<LI>three final fields for internal use
</LI>
</UL>
After this the two sequences are written as <TT>'SEQ1'</TT> and <TT>'SEQ2'</TT>, as a simple
mapping from alignment positions to sequences.

<P>
Note that <I CLASS="sans">subopt_offset</I><A NAME="30568"></A> should be positive for alignments using distance
matrices (<I CLASS="sans">similarity_flag</I><A NAME="30571"></A> = <TT>False</TT>) and negative when using similarity
matrices (<I CLASS="sans">similarity_flag</I><A NAME="30575"></A> = <TT>True</TT>).

<P>
Note that because the suboptimal alignments are generated sequentially,
the alignment in memory at the end of the command will be the last (or worst)
suboptimal alignment, <SPAN  CLASS="textit">not</SPAN> the optimal alignment.

<P>
The suboptimal alignment file can be converted into a set of real alignments
using the <B><A HREF="node319.html#CMD:Alignment.getsuboptimals">Alignment.get_suboptimals()</A></B><A NAME="30579"></A> method.

<P>

  <DL>
<DT><STRONG>Example: <A NAME="tex2html195"
  HREF="../examples/salign/salign_subopt.py">examples/salign/salign_subopt.py</A></STRONG></DT>
<DD> <BR>  <div class="pygments"><pre><span></span><span class="kn">from</span> <span class="nn">modeller</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">()</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environ</span><span class="p">()</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fm07254_test.ali&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PIR&#39;</span><span class="p">)</span>
<span class="n">aln</span><span class="o">.</span><span class="n">salign</span><span class="p">(</span><span class="n">feature_weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">gap_penalties_1d</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">450</span><span class="p">,</span> <span class="o">-</span><span class="mi">50</span><span class="p">),</span>
           <span class="n">n_subopt</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">subopt_offset</span> <span class="o">=</span> <span class="mi">15</span><span class="p">)</span>

<span class="c1"># Convert suboptimal alignment output file into actual alignments</span>
<span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;suboptimal_alignments.out&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">aln</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">aln</span><span class="o">.</span><span class="n">get_suboptimals</span><span class="p">(</span><span class="n">f</span><span class="p">)):</span>
    <span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fm07254_out</span><span class="si">%d</span><span class="s1">.ali&#39;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
  
</DD>
</DL>  <BR>
<P>

<H3><A NAME="SECTION00111626600000000000000">
Alignments using external restraints</A>
</H3>
<B>Fix positions:</B>
The user can choose to have certain alignment positions "fixed" by offsetting
the appropriate matrix entries. 
This is done by adding a new pseudo sequence to the alignment with the align
code <TT>._fix_pos</TT>. The residues of this pseudo sequence are integer values
from 0 through 4 (alternatively, a blank is equivalent to 0).
Any alignment position at which this pseudo sequence contains a '0' is treated
normally; if, however, a non-zero integer is used, the alignment matrix is
offset, generally making the alignment in that position more favorable (and
more so for higher integers). The actual offset values themselves can be
specified by the user by setting the <I CLASS="sans">fix_offsets</I><A NAME="30588"></A> variable.
Note that since SALIGN converts all DP scoring matrices to distance
matrices (unless otherwise specified using <I CLASS="sans">similarity_flag</I><A NAME="30591"></A>), the
values of <I CLASS="sans">fix_offsets</I><A NAME="30594"></A> used in anchoring alignment positions should be 
numerically smaller or negative in comparison to the values in the DP matrix.

<P>

  <DL>
<DT><STRONG>Example: <A NAME="tex2html196"
  HREF="../examples/salign/salign_fix_positions.py">examples/salign/salign_fix_positions.py</A></STRONG></DT>
<DD> <BR>  <div class="pygments"><pre><span></span><span class="c1"># Demonstrating the use of alignment restraints, only available in</span>
<span class="c1"># align2d and salign:</span>
<span class="kn">from</span> <span class="nn">modeller</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">()</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environ</span><span class="p">()</span>

<span class="c1"># The special alignment entry &#39;_fix_pos&#39; has to be the last entry in the</span>
<span class="c1"># alignment array. Its sequence contains characters blank (or 0), 1, 2, 3,</span>
<span class="c1"># and 4 at the restrained alignment positions. The residue-residue score from</span>
<span class="c1"># the substitution matrix for these positions will be offset by the scalar</span>
<span class="c1"># value FIX_OFFSETS[0..4].</span>
<span class="n">aln</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fix_positions.ali&#39;</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;1leh&#39;</span><span class="p">,</span> <span class="s1">&#39;3btoA&#39;</span><span class="p">,</span>
                                                            <span class="s1">&#39;_fix_pos&#39;</span><span class="p">))</span>

<span class="c1"># fix_offsets specifies the offset corresponding to character &#39; 1234&#39; in the</span>
<span class="c1"># _fix_pos entry in the alignment</span>
<span class="c1"># (this offsets unlabeled positions for 0, the ones indicated by 1 by</span>
<span class="c1">#  1000, those indicated by 2 by 2000, etc.)</span>
<span class="n">aln</span><span class="o">.</span><span class="n">salign</span><span class="p">(</span><span class="n">fix_offsets</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">10</span><span class="p">,</span> <span class="o">-</span><span class="mi">20</span><span class="p">,</span> <span class="o">-</span><span class="mi">30</span><span class="p">,</span> <span class="o">-</span><span class="mi">40</span><span class="p">),</span>
           <span class="n">gap_penalties_2d</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="c1"># Any values are</span>
                                                         <span class="c1"># possible here</span>
           <span class="n">local_alignment</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="c1"># Local alignment works, too</span>
           <span class="n">gap_penalties_1d</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">600</span><span class="p">,</span> <span class="o">-</span><span class="mi">400</span><span class="p">))</span> <span class="c1"># This is best with the default value</span>
                                          <span class="c1"># of gap_penalties_2d</span>

<span class="c1"># Write it out, the _fix_pos is erased automatically in salign:</span>
<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;fix_positions_salign.pap&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PAP&#39;</span><span class="p">)</span>
</pre></div>
  
</DD>
</DL>  <BR>
<P>
<B>External weight matrix:</B> An example of using feature 6.

<P>

  <DL>
<DT><STRONG>Example: <A NAME="tex2html197"
  HREF="../examples/salign/salign_external_matrix.py">examples/salign/salign_external_matrix.py</A></STRONG></DT>
<DD> <BR>  <div class="pygments"><pre><span></span><span class="c1"># Reads an external matrix</span>
<span class="kn">from</span> <span class="nn">modeller</span> <span class="kn">import</span> <span class="o">*</span>

<span class="n">log</span><span class="o">.</span><span class="n">verbose</span><span class="p">()</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">Environ</span><span class="p">()</span>

<span class="n">aln</span> <span class="o">=</span> <span class="n">Alignment</span><span class="p">(</span><span class="n">env</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="s1">&#39;1dubA-1nzyA.ali&#39;</span><span class="p">,</span> <span class="n">align_codes</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>

<span class="n">aln</span><span class="o">.</span><span class="n">salign</span><span class="p">(</span><span class="n">alignment_type</span><span class="o">=</span><span class="s1">&#39;pairwise&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
           <span class="n">rr_file</span><span class="o">=</span><span class="s1">&#39;$(LIB)/blosum62.sim.mat&#39;</span><span class="p">,</span>
           <span class="c1">#rr_file=&#39;$(LIB)/as1.sim.mat&#39;,</span>
           <span class="c1">#max_gap_length=20,</span>
           <span class="n">gap_function</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
           <span class="n">input_weights_file</span><span class="o">=</span><span class="s1">&#39;external.mtx&#39;</span><span class="p">,</span>   <span class="c1"># External weight matrix</span>
           <span class="c1">#weights_type=&#39;DISTANCE&#39;,            # type of ext. wgt. mtx</span>
           <span class="c1"># ensure appropriate gap penalites for the ext. matrix</span>
           <span class="c1">#feature_weights=(1., 0., 0., 0., 0., 0.), gap_penalties_1d=(30, 26),</span>
           <span class="c1">#output_weights_file=&#39;score.mtx&#39;,</span>
           <span class="n">feature_weights</span><span class="o">=</span><span class="p">(</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">),</span>
           <span class="n">gap_penalties_1d</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">500</span><span class="p">,</span> <span class="o">-</span><span class="mi">300</span><span class="p">))</span>
<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;output.ali&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PIR&#39;</span><span class="p">)</span>
<span class="n">aln</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">file</span><span class="o">=</span><span class="s1">&#39;output.pap&#39;</span><span class="p">,</span> <span class="n">alignment_format</span><span class="o">=</span><span class="s1">&#39;PAP&#39;</span><span class="p">)</span>
</pre></div>
  
</DD>
</DL>  <BR>
<P>
<B>Multiple structure alignment according to a user specified dendrogram</B>
The user has the option of inputting an <SPAN CLASS="MATH"><IMG
 WIDTH="14" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img43.png"
 ALT="$n$"></SPAN> X <SPAN CLASS="MATH"><IMG
 WIDTH="14" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img43.png"
 ALT="$n$"></SPAN> matrix from which a 
dendrogram can be inferred. The multiple tree alignment is then confined to 
follow this externally input dendrogram. To effect this, specify the name of
the external matrix file with the <I CLASS="sans">ext_tree_file</I><A NAME="30605"></A> variable. The format of
this file is the same as the external weight matrix, above; the first line of
the file contains the dimensions of the matrix (in this case it should be a
square matrix, with both dimensions equal to the number of sequences in the
alignment), and subsequent lines contain sequence-sequence distances, one row
of the matrix per line.

<P>

<H3><A NAME="SECTION00111626700000000000000">
Gap penalties and correcting for gaps</A>
</H3>
SALIGN makes use of three sets of gap penalties. <I CLASS="sans">gap_penalties_1d</I><A NAME="30608"></A> are for
dynamic programming making use of constant gap penalties. <I CLASS="sans">gap_penalties_2d</I><A NAME="30611"></A>
are when a variable function for gap penalty is used. <I CLASS="sans">gap_penalties_3d</I><A NAME="30614"></A> is
used along with feature 2 only, when structures are aligned by a least squares
fit of their atomic positions.
All SALIGN features produce some measure of residue equivalence (similarity or 
distance scores). The scales of these scores differ depending on the feature 
used. For optimal usage, <I CLASS="sans">gap_penalties_1d</I><A NAME="30617"></A> should be set appropriately 
considering the features used. 
Note: If feature 1  is non zero and a similarity substitution matrix is 
employed, no matter what other features are also used in conjunction, 
<I CLASS="sans">gap_penalties_1d</I><A NAME="30620"></A> should always take on values appropriate to the
substitution matrix used.
For example, if feature 1 is non zero (other features may or may not be 
non-zero), and the residue substitution matrix used is the BLOSUM62 similarity 
matrix, <I CLASS="sans">gap_penalties_1d</I><A NAME="30623"></A> is set to (-450, -50) and when feature 1 is zero 
<I CLASS="sans">gap_penalties_1d</I><A NAME="30626"></A> is set to values appropriate for a distance matrix, 
<EM>e.g.</EM>, (2, 3). 
A word of caution: gap penalties have not yet been optimized for aligning
sequences by their profiles and for structure alignments.

<P>
The gap correction function is
<!-- MATH
 $g_{i,j} = \frac{n_{rg}}{(n_1 n_2)} r + \frac{n_{gg}}{(n_1 n_2)} g$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="167" HEIGHT="33" ALIGN="MIDDLE" BORDER="0"
 SRC="img133.png"
 ALT="$g_{i,j} = \frac{n_{rg}}{(n_1 n_2)} r + \frac{n_{gg}}{(n_1 n_2)} g$"></SPAN>,
where <SPAN CLASS="MATH"><IMG
 WIDTH="21" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img134.png"
 ALT="$n_1$"></SPAN> and <SPAN CLASS="MATH"><IMG
 WIDTH="21" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img135.png"
 ALT="$n_2$"></SPAN> are the number of proteins in the two sub-alignments,
<SPAN CLASS="MATH"><IMG
 WIDTH="27" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img136.png"
 ALT="$n_{rg}$"></SPAN> is the number of gap-residue pairs, and <SPAN CLASS="MATH"><IMG
 WIDTH="28" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img137.png"
 ALT="$n_{gg}$"></SPAN> is the number of
gap-gap pairs when comparing protein positions from one sub-alignment with
protein position from the other sub-alignment, <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img138.png"
 ALT="$r$"></SPAN> is <I CLASS="sans">gap_residue_score</I><A NAME="30630"></A>
and <SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img139.png"
 ALT="$g$"></SPAN> is <I CLASS="sans">gap_gap_score</I><A NAME="30633"></A>. The smaller (even negative) is
<I CLASS="sans">gap_gap_score</I><A NAME="30636"></A>, and the larger is <I CLASS="sans">gap_residue_score</I><A NAME="30639"></A>, the more will
the gaps be aligned with gaps.

<P>
Whenever an alignment of two sequences is done and feature 1 is non-zero,
SALIGN will attempt to keep any chain breaks aligned. This behavior can be
tuned by setting the <I CLASS="sans">break_break_bonus</I><A NAME="30642"></A> parameter.
See <B><A HREF="node311.html#CMD:Alignment.align">Alignment.align()</A></B><A NAME="30645"></A> for more information.

<P>

<H3><A NAME="SECTION00111626800000000000000">
Useful SALIGN information and commands</A>
</H3>
The <B><A HREF="#CMD:Alignment.salign">Alignment.salign()</A></B><A NAME="30650"></A> command uses position-position dissimilarity
scores (except when <I CLASS="sans">similarity_flag</I><A NAME="30655"></A> is switched on), as opposed to
similarity scores. This convention applies to all the features, including the
residue-residue similarities read from the <I CLASS="sans">rr_file</I><A NAME="30658"></A>; however, if a residue
type - residue type similarity matrix is read in, it is automatically
converted into the distance matrix by <!-- MATH
 $D = \max_{i,j} S_{i,j}  - S$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="141" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img140.png"
 ALT="$D = \max_{i,j} S_{i,j} - S$"></SPAN>.
In addition, it is also scaled linearly such that the residue-residue
dissimilarity scores range from 0 to 1 (to facilitate weighting this feature
with other features).

<P>
For each pairwise alignment, the weight matrix <SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img129.png"
 ALT="$W$"></SPAN> has dimensions <SPAN CLASS="MATH"><IMG
 WIDTH="19" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img122.png"
 ALT="$N$"></SPAN> and <SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="14" ALIGN="BOTTOM" BORDER="0"
 SRC="img83.png"
 ALT="$M$"></SPAN>
that correspond to the lengths of the sub-alignments to be aligned based on
the weight matrix <SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img129.png"
 ALT="$W$"></SPAN>. The dissimilarity score for aligning position <SPAN CLASS="MATH"><IMG
 WIDTH="10" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img60.png"
 ALT="$i$"></SPAN> with
position <SPAN CLASS="MATH"><IMG
 WIDTH="12" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img66.png"
 ALT="$j$"></SPAN> is calculated as
<!-- MATH
 $W_{i,j} = \sum_f [ \frac{\omega_f}{\sum_f \omega_f} W^f_{i,j} ] + g_{i,j}$
 -->
<SPAN CLASS="MATH"><IMG
 WIDTH="203" HEIGHT="38" ALIGN="MIDDLE" BORDER="0"
 SRC="img141.png"
 ALT="$W_{i,j} = \sum_f [ \frac{\omega_f}{\sum_f \omega_f} W^f_{i,j} ] + g_{i,j}$"></SPAN>,
where the sum runs over all selected features <SPAN CLASS="MATH"><IMG
 WIDTH="14" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img74.png"
 ALT="$f$"></SPAN>, and <SPAN CLASS="MATH"><IMG
 WIDTH="13" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img139.png"
 ALT="$g$"></SPAN> is a function that
may be used to correct the <SPAN CLASS="MATH"><IMG
 WIDTH="34" HEIGHT="29" ALIGN="MIDDLE" BORDER="0"
 SRC="img142.png"
 ALT="$W_{i,j}$"></SPAN> score for the presence of gaps within the
sub-alignments (see below). A feature <SPAN CLASS="MATH"><IMG
 WIDTH="14" HEIGHT="30" ALIGN="MIDDLE" BORDER="0"
 SRC="img74.png"
 ALT="$f$"></SPAN> is selected when its weight
<SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img143.png"
 ALT="$\omega_f$"></SPAN> (specified in <I CLASS="sans">feature_weights</I><A NAME="30661"></A>) is non-zero. The matrices
<SPAN CLASS="MATH"><IMG
 WIDTH="30" HEIGHT="18" ALIGN="BOTTOM" BORDER="0"
 SRC="img144.png"
 ALT="$W^f$"></SPAN> are normalized to have the mean of 0 and standard deviation of 1 when
<I CLASS="sans">normalize_pp_scores</I><A NAME="30664"></A> is <TT>True</TT>, but it is recommended not to use this
option for now (<EM>i.e.</EM>, use <I CLASS="sans">feature_weights</I><A NAME="30669"></A> to scale the contributions of
the different features to the final <SPAN CLASS="MATH"><IMG
 WIDTH="22" HEIGHT="15" ALIGN="BOTTOM" BORDER="0"
 SRC="img129.png"
 ALT="$W$"></SPAN>). The weights of 1 will weigh the
different features approximately evenly (the residue-residue dissimilarities
of feature 1 are scaled to a range from 0 to 1, the position differences of
feature 2 are in angstroms, the fractional solvent accessibility scores of
feature 3 and the secondary structure scores of feature 4 range from 0 to 2,
and the DRMS difference of feature 5 is expressed in angstroms).

<P>
If you enable verbose logging with <B><A HREF="node451.html#CMD:log.verbose">log.verbose()</A></B><A NAME="30672"></A>, there will be more 
output in the <TT>'log'</TT> file, such as the dendrogram. The dendrogram can also be 
written out in a separate file by specifying the file name to 
<I CLASS="sans">dendrogram_file</I><A NAME="30678"></A>.

<P>
Argument <I CLASS="sans">output</I><A NAME="30681"></A> can contain the following values:

<UL>
<LI><TT>'ALIGNMENT'</TT>: the alignments in the first <SPAN CLASS="MATH"><IMG
 WIDTH="41" HEIGHT="28" ALIGN="MIDDLE" BORDER="0"
 SRC="img145.png"
 ALT="$n-2$"></SPAN> stages of the pairwise
alignment of sub-alignments are written out.

<P>
</LI>
<LI><TT>'QUALITY'</TT>: the final alignment is used to obtain pairwise least-squares
superpositions and the corresponding average and minimal numbers of pairs of
aligned residues that are within <I CLASS="sans">rms_cutoff</I><A NAME="30686"></A> &#197; in all pairs of
aligned structures. These numbers can be used as absolute quality measures
for the final multiple alignment. This option requires the coordinate files
for the aligned proteins.
</LI>
</UL>

<P>
If <I CLASS="sans">write_fit</I><A NAME="30689"></A> is <TT>True</TT>, the fitted atom files are written out in their
fitted orientations. For this and other options below, also read the text
above.

<P>
If <I CLASS="sans">output_weights_file</I><A NAME="30693"></A> is specified, the dynamic programming weight
matrix is written out into the file. (If it is <TT>None</TT>, no file is written
out.)

<P>
If <I CLASS="sans">current_directory</I><A NAME="30697"></A> is <TT>True</TT>, the output <TT>_pdb.fit</TT> files will
be written to the current directory. Otherwise, the output will be in the
directory with the original files<A NAME="tex2html198"
  HREF="footnode.html#foot30152"><SUP><SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">9</SPAN></SUP></A>.

<P>
If <I CLASS="sans">write_whole_pdb</I><A NAME="30710"></A> is <TT>True</TT>, the whole PDB files are written
out<A NAME="tex2html199"
  HREF="footnode.html#foot30155"><SUP><SPAN CLASS="arabic">6</SPAN>.<SPAN CLASS="arabic">10</SPAN></SUP></A>; otherwise only the parts
corresponding to the aligned sequences are output.

<P>
If <I CLASS="sans">fit</I><A NAME="30719"></A> is <TT>False</TT>, the initial superposition is not changed. This is
useful when all the structures have to be compared with a given alignment
as is, without changing their relative orientation.

<P>
If <I CLASS="sans">fit_on_first</I><A NAME="30723"></A> is <TT>True</TT>, the structures are fit to the first
structure according to the final alignment before they are written out.

<P>
If <I CLASS="sans">improve_alignment</I><A NAME="30727"></A> is <TT>False</TT>, the initial alignment is not changed,
though the structures may still be superimposed if <I CLASS="sans">fit</I><A NAME="30731"></A> = <TT>True</TT>. This
is useful when all the structures have to be superimposed with the initial
alignment.

<P>

<DIV CLASS="navigation"><HR>
<!--Navigation Panel-->
<A NAME="tex2html6569"
  HREF="node319.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next.png"></A> 
<A NAME="tex2html6563"
  HREF="node292.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up.png"></A> 
<A NAME="tex2html6557"
  HREF="node317.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="prev.png"></A> 
<A NAME="tex2html6565"
  HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents.png"></A> 
<A NAME="tex2html6567"
  HREF="node517.html">
<IMG WIDTH="43" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="index" SRC="index.png"></A> 
<BR>
<B> Next:</B> <A NAME="tex2html6570"
  HREF="node319.html">Alignment.get_suboptimals()   parse</A>
<B> Up:</B> <A NAME="tex2html6564"
  HREF="node292.html">The Alignment class: comparison</A>
<B> Previous:</B> <A NAME="tex2html6558"
  HREF="node317.html">Alignment.malign3d()   align</A>
 &nbsp; <B>  <A NAME="tex2html6566"
  HREF="node1.html">Contents</A></B> 
 &nbsp; <B>  <A NAME="tex2html6568"
  HREF="node517.html">Index</A></B> </DIV>
<!--End of Navigation Panel-->

</BODY>
</HTML>
